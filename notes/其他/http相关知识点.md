# HTTP相关知识点

## 一、一次完整的HTTP服务过程

建立连接，发送请求做出响应阶段**

1. 对网址进行DNS域名解析，得到网址对应的ip地址

   ```
   DNS怎么把url对应到ip地址的：
   先查找浏览器自身的DNS缓存，以chrome为例可以通过输入chrome://net-internals/#dns 来查看，寿命1小时最多一千条
   -> 系统的DNS缓存
   -> host文件
   -> 根域名服务器
   ```

   1. 根据IP地址找到对应的服务器后，向服务器发起TCP的三次握手

   ```
   ⒈客户端：你是XXX服务端吗？
   ⒉服务端： 我是XXX服务端，你是客户端吗？
   ⒊客服端： 是的，我是客户端
   ```

   > 扩展： 四次挥手断开连接

   ```
   ⒈主动方： 我已经关闭了向你那边的信息发送通道，只能被动接受信息了；
   ⒉被动方： 收到通道关闭的信息；
   ⒊被动方： 我现在也关闭了向你那边发送信息的通道
   ⒋主动方： 最后收到信息，连接断开，之后双方无法通信
   ```

   2. 三次握手成功后建立TCP连接，客户端发送HTTP请求

   3. 服务端接收到HTTP请求后查找请求的资源，并且做出响应

      其中相应内容包括HTTP状态码，如果状态码是301则表示永久重定向，且响应报文里一般包含重定向的url，客户端收到报文后对url做相应改变重新发送

   4. 请求成功后服务器返回对应的HTML文件，进入到页面渲染阶段

   **页面渲染**

   浏览器解析HTML结构，构建DOM树，构建渲染树，布局渲染树，绘制渲染树。

   DOM树是由HTML文件中的标签排列组成，渲染树是DOM树中加入CSS或者HTML中的style样式形成的，DOM树只包含显示在页面的DOM元素，而像`<head></head>>`

   或者display: none的元素都不在渲染树中。

    在浏览器还没接收到完整的HTML文件时，它就开始渲染页面了，在遇到外部链入的脚本标签或样式标签或图片时，会再次发送HTTP请求重复上述的步骤。在收到CSS文件后会对已经渲染的页面重新渲染，加入它们应有的样式，图片文件加载完立刻显示在相应位置。在这一过程中可能会触发页面的重绘或重排。 

     

   服务器关闭TCP链接 

   > 扩展

   TCP 三次握手，四次挥手

   ```js
   // 可以保持打开状态，浏览器可以继续通过相同的连接发送请求，节省建立请求的时间和网络带宽
   // 在浏览器或服务器头信息加入下面代码
   Connection:keep-alive
   ```

   


## 二、HTTP缓存

### 1.强缓存

- 存在的意义：能够减少服务器的的需求数量，解决更多的并发

- 标志：http返回码是200 Size 显示(from cache)

#### 1.1 Expires

绝对时间，服务端的具体时间点，用于指定资源到期时间

缺点: 服务器与客户端时间偏差变大后会导致缓存混乱，所以才有了Cache-control

#### 1.2 Cache-conctrol

相对时间，比如Cache-Control:3600 代表资源的有效期是3600秒，用于弥补Expires的缺点

两者冲突时以Cache-control 为准，包含了max-age的字段，单位为秒



### 2.协商缓存

若未命中强缓存，则浏览器将请求发送至服务器

服务器根据 http 头信息的Last-Modifty / If-Modify-Since 或 Etag / If-None-Match 来判断是否命中协商缓存   

若命中协商缓存 http 返回码为304   ，浏览器从缓存中加载资源

#### 2.1Last-Modifty / If-Modify-Since

请求头中 携带上次修改的对应的服务器时间，如果没有修改，304不返回资源

时间精度秒，由于精度问题所以有Etag作为补充

#### 2.2Etag / If-None-Match

Etag一个校验码，每一次修改都会改变，服务器根据浏览器发送的if-none-match判断是否命中

## 三、http 和 https

#### HTTP

- http是不安全的

http协议传输的内容都是明文，直接在TCP连接上运行，客户端和服务器都无法验证对方身份

### HTTPS

- https 协议的传输内容都被SSL/TLS 加密，且运行在SSL/TLS上，SSL/TLS 运行在TCP连接上，所以数据传输是安全的

  SSL : Secure Socket Layer 安全套接层

  TLS : Transport Layer Security 传输层安全



## 四、TCP 和 UDP

### TCP 传输控制协议

特点：面向连接，收发数据前必须建立可靠的连接

建立连接的基础:三次握手，（验证客户端和服务端收发报文的能力）

```
// 三次握手
客户端                    服务端
SYN 200     ->               
             <-         SYN 500 ACK 201
SYN 201 ACK 501  ->
```

应用场景：数据传输必须准确无误的手法

比如 HTTP请求、FTP文件传输、邮件收发

- 优点: 稳定、重传机制、拥塞控制机制、可以实时断开连接

- 缺点: 速度慢，效率低，占用资源，容易被攻击(三次握手 ->  DOS\DDOS攻击)

### UDP 

User Data Protocol 用户数据协议

特点: 面向无连接 ，不可靠的协议，无状态传输机制

无连接信息发送机制

应用场景:无需确保通信质量，且要求速度快，无需确保信息完整

比如：语音通话，直播

- 优点：安全快速漏洞少(UDO flood攻击)

- 缺点：不可靠不稳定，容易丢包

  只要目的的源地址、端口号、地址、端口号确定，就可以直接发送信息报文，但不能保证一定能收到完整的数据

### OSI七层模型 和 TCP/IP 四层模型

#### OSI七层模型

- 应用层
- 表示层
- 会话层
- 传输层
- 网络层
- 数据链路层
- 物理层

------

#### TCP/IP 四层模型

- 应用层：应用层、表示层、会话层：HTTP

- 传输层：传输层 ：TCP/UDP
- 网络层：网络层：IP
- 数据链路层：数据链路层、物理层

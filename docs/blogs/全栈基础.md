#### nodejs 是什么

​	nodejs 是基于<u>Chrome V8 引擎</u>的 <u>Javascript 运行时</u>

​	nodejs 出现前， js 只能在浏览器上运行, nodejs 出现后， js 可以在任何安装 nodejs 的环境运行



#### commonjs 和 ES6 Module 的区别

语法不同

commonjs 是**动态引入**， 执行时引入

```js
// 可以运行时引入，不会报错
if (a>1) {
    const { foo, bar } = require('./xxxx.js')
}

```

ES6 Module 是**静态引入**， 编译时引入， 在使用时，必须放在最外层

```js
import { foo, bar } from './xxxx.js'
if (foo) {
    return 'xxx'
}
// 如果放在内部运行时引入则会报错
```

<u>commonjs 的三个层级</u> ：

- nodejs 自带模块,如 require('http')
- npm 安装的模块,如 require('lodash')
- 自定义的模块,如 require('../utils.js')

#### nodejs 和 前端 js 的区别

**同** : 都是用 ES 语法

**异** ：**API 不同**， nodejs 使用 node API  (http、querystring 等)

​		前端 js 使用 JS web API （DOM、BOM、ajax 等）

​		**应用场景不同** 前端 js 用于网页,在浏览器运行，nodejs 可以用于服务端，如 web server ,nodejs 也可用于本机，如webpack 等本机的工具

------



#### 题目

- 如何启动 http 服务

  ```js
  const http = require('http')
  const server = http.createServer((req, res) => {
      console.log('已经收到请求', req) // 从 req 中获取客户端请求
  	res.end('hello world') // 使用 res 设置返回信息
  })
  server.listen(3000) // 监听端口
  ```

- 如何定义路由

  ```js
  const http = require('http')
  const server = http.createServer((req, res) => {
      const method = req.method
      const url =req.url
      const pathname = url.split('?')[0] // 获取pathname
      
      // 根据pathname 定义路由
      if (method === 'GET' && pathname === 'xxx') {
          req.end('访问了xxx路由')
      }
  })
  server.listen(3000)
  ```

- 如何获取 querystring

  ```js
  const http = require('http')
  const server = http.createServer((req, res) => {
      const querystring = req.url.split('?')[1]
      const query = querystring.split('&')
      
  })
  ```

- 结构化和非结构化

  结构化的数据，易于通过程序访问和分析，如对象和数组，非结构化的数据如字符串等，在编程的过程中尽量转化为结构化的数据

- 如何获取 Requset body

  ```js
  const http = require('http')
  const server = http.createServer((req, res) => {
      if (req.method === 'POST') {
          // 数据格式查看
          console.log('content-type', request.headers['content-type'])
          // 接受数据
          let postData = ''
          // 流,stream 数据的接收
          req.on('data', chunk => {
              postData = postData + chunk.toString()
          })
          req.on('end', () => {
              console.log('postData')
              res.end('返回数据') 
          })
      }
  })
  server.listen(3000)
  ```

- 如何返回 JSON 格式的数据

  ```js
  res.writeHead(200,{
  	"Content-type": "application/json"
  })
  res.end(
  	JSON.stringify(someObject) // 注意，返回的是字符串
  )
  ```

- session 如何实现登录

  - cookie 可以实现登录校验 --> cookie 不能泄露用户信息,所以才有了session

  - session 存储用户信息，cookie 和 session 关联

    ![Hylo.png](https://u.vmpic.cn/2021/03/27/Hylo.png)

#### nodejs 框架

框架的作用和价值

- 封装原生 API ,让开发更简单
- 规范流程和格式, 如 koa2 的中间件
- 让开发人员专注与业务和功能的开发

async / await 执行顺序的问题

```JS
async function async1 () {
	console.log('async1 start')
    await async2()
    console.log('async1 end')
}
async function async2 () {
    console.log('async2')
}

console.log('script start')
async1()
console.log('script end')

// 上述代码打印结果如下
	script start ---> async1 start ---> async2 --->script end --->async1 end
    // await 下面行的代码相当于异步代码，等同步代码执行完后才会执行异步代码
```

#### koa2 处理路由

```js
router.post('/create',async function (ctx, next) {
	const query = ctx.query
	const reqBody =ctx.request.body
	ctx.body = {
		errno: 0
	}
})
```

#### koa2 洋葱圈模型

![HLBR.png](https://u.vmpic.cn/2021/03/27/HLBR.png)

![HhMS.png](https://u.vmpic.cn/2021/03/27/HhMS.png)

#### 服务端经典的分层模型

![HS7N.png](https://u.vmpic.cn/2021/03/27/HS7N.png)



#### MongoDB 面试题

​	**DB Collection Document 分别是什么**

- DB - 数据库， 一个系统的数据集合， 如留言板项目

- Collection - 集合，一类数据的集合，如所有用户数据

- Document - 文档，单个数据，如一个用户的数据

  

​	Mongoose 的 Schema 和 Model

-  Schema - 数据规范，定义哪些属性，数据类型，是否必需等
- Model - 数据模型，提供 API 操作 Document
- Model 依赖一个Schema 规范，对应一个 Collection

```js
const CommentSchema = mongoose.Schema({
    username: {
        type: String,
        required: true
    },
    content: {
        type: String,
        required: true
    }
}, {
    timestamps: true // 时间戳
})

const Comment = mongoose.Model('comment', CommentSchema)
```

  